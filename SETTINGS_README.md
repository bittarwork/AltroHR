# نظام إعدادات AltroHR - دليل الاستخدام

## نظرة عامة

تم تطوير نظام إعدادات شامل وفعلي للنظام، حيث تؤثر الإعدادات فوراً على سلوك النظام.

## ✅ الإعدادات الفعالة (تعمل حالياً)

### 1. الإعدادات العامة

- **اسم النظام**: يظهر في واجهة المستخدم
- **وصف النظام**: وصف مختصر للنظام
- **اللغة الافتراضية**: العربية أو الإنجليزية
- **المنطقة الزمنية**: الرياض، دبي، الكويت
- **ساعات العمل**: بداية ونهاية الدوام الرسمي

### 2. إعدادات الأمان (تطبق فوراً)

- **وضع الصيانة**:
  - ✅ يمنع وصول جميع المستخدمين عدا الإداريين
  - ✅ يُظهر رسالة صيانة للمستخدمين العاديين
- **السماح بالتسجيل**:

  - ✅ يمنع/يسمح التسجيل الجديد في النظام
  - ✅ يُظهر رسالة مناسبة عند المنع

- **مهلة الجلسة**:
  - ✅ تطبق على جميع المستخدمين الجدد
  - ✅ نطاق: 30-1440 دقيقة (8 ساعات افتراضياً)
- **عدد محاولات تسجيل الدخول**:
  - ✅ يحدد العدد الأقصى للمحاولات
  - ✅ نطاق: 3-10 محاولات

### 3. إعدادات الإشعارات

- **إشعارات البريد الإلكتروني**: ✅ فعالة
- **إشعارات الرسائل النصية**: 🚧 قيد التطوير

## 🚧 الإعدادات قيد التطوير

### إعدادات النسخ الاحتياطي

- تكرار النسخ الاحتياطي
- حالة النسخ الاحتياطية
- استعادة النسخ

### الميزات المتقدمة

- التقارير المتقدمة
- التكامل مع الأنظمة الخارجية
- استيراد الإعدادات

## 🛠️ كيفية الاستخدام

### للمطورين:

#### 1. تهيئة الإعدادات الأولية

```bash
cd backend
node scripts/initializeSettings.js
```

#### 2. الحصول على الإعدادات في الكود

```javascript
const SystemSettings = require("./models/SystemSettings");

// الحصول على الإعدادات
const settings = await SystemSettings.getSettings();

// تحديث الإعدادات
const updatedSettings = await SystemSettings.updateSettings(
  newSettings,
  userId
);
```

#### 3. استخدام إعدادات الأمان

```javascript
const {
  getSecuritySettings,
} = require("./middleware/systemSettingsMiddleware");

const securitySettings = await getSecuritySettings();
console.log(securitySettings.maintenanceMode); // true/false
```

### للمستخدمين:

#### 1. الوصول للإعدادات

- اذهب إلى لوحة التحكم الإدارية
- اختر تبويب "إعدادات النظام"
- قم بتعديل الإعدادات المطلوبة
- اضغط "حفظ الإعدادات"

#### 2. تصدير الإعدادات

- في صفحة الإعدادات، اضغط "تصدير الإعدادات"
- سيتم تحميل ملف JSON يحتوي على جميع الإعدادات

#### 3. إعادة تعيين الإعدادات

- اضغط "إعادة تعيين" لاستعادة القيم الافتراضية
- تأكد من العملية قبل المتابعة

## 🔐 الأمان والصلاحيات

### الوصول للإعدادات:

- **للقراءة**: الإداريون فقط
- **للتعديل**: الإداريون فقط
- **للتصدير**: الإداريون فقط

### تطبيق الإعدادات:

- **وضع الصيانة**: يطبق فوراً على جميع الطلبات
- **إعدادات الجلسة**: تطبق على الجلسات الجديدة
- **التسجيل**: يطبق فوراً على محاولات التسجيل

## 🧪 اختبار الإعدادات

### اختبار وضع الصيانة:

1. فعّل وضع الصيانة من الإعدادات
2. سجل خروج من حساب إداري
3. حاول تسجيل الدخول بحساب موظف عادي
4. يجب أن تظهر رسالة صيانة

### اختبار منع التسجيل:

1. عطّل "السماح بالتسجيل"
2. حاول إنشاء حساب جديد
3. يجب أن تظهر رسالة منع

### اختبار مهلة الجلسة:

1. قم بتقليل مهلة الجلسة لدقيقة واحدة
2. انتظر دقيقة واحدة بعد تسجيل الدخول
3. حاول الوصول لأي صفحة
4. يجب أن تُعاد توجيهك لصفحة تسجيل الدخول

## 📊 API Endpoints

```
GET    /api/system-settings          # جلب الإعدادات
PUT    /api/system-settings          # تحديث الإعدادات
POST   /api/system-settings/reset    # إعادة تعيين
GET    /api/system-settings/export   # تصدير الإعدادات
POST   /api/system-settings/import   # استيراد الإعدادات (قيد التطوير)
GET    /api/system-settings/features # جلب حالة الميزات
```

## 🔄 التحديثات المستقبلية

### المرحلة القادمة:

- [ ] نظام النسخ الاحتياطي التلقائي
- [ ] إشعارات الرسائل النصية
- [ ] استيراد الإعدادات
- [ ] التكامل مع الأنظمة الخارجية
- [ ] إعدادات البريد الإلكتروني المتقدمة

### التحسينات الأمنية:

- [ ] تشفير الإعدادات الحساسة
- [ ] سجل تغييرات الإعدادات
- [ ] التحقق بخطوتين للتغييرات الحساسة
- [ ] نسخ احتياطية للإعدادات

## 🐛 استكشاف الأخطاء

### مشاكل شائعة:

**الإعدادات لا تحفظ:**

- تأكد من صلاحيات المستخدم (admin)
- تحقق من اتصال قاعدة البيانات
- راجع console للأخطاء

**وضع الصيانة لا يعمل:**

- تأكد من إعادة تشغيل الخادم بعد التحديث
- تحقق من middleware في app.js

**مهلة الجلسة لا تطبق:**

- الإعدادات تطبق على الجلسات الجديدة فقط
- قم بتسجيل خروج وإعادة دخول

## 📝 ملاحظات للمطورين

1. **الإعدادات تحفظ في MongoDB collection: `systemsettings`**
2. **تطبق Middleware للأمان في `app.js`**
3. **استخدم `SystemSettings.getSettings()` للحصول على الإعدادات**
4. **تحقق من الأخطاء في console عند تعديل الإعدادات**
5. **الميزات المعلمة بـ "قيد التطوير" ستكون متاحة في التحديثات القادمة**

---

**تم التطوير بواسطة**: فريق AltroHR  
**آخر تحديث**: يونيو 2025  
**الإصدار**: 2.1.0
